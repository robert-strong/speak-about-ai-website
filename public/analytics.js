(function(){'use strict';try{if(window.location.protocol==='chrome-extension:'||window.location.protocol==='moz-extension:')return}catch(e){}function hasAnalyticsConsent(){try{if(localStorage.getItem('adminLoggedIn')==='true')return false;const consent=localStorage.getItem('cookie-consent');if(!consent)return false;return JSON.parse(consent).analytics===true}catch{return false}}function trackPageView(){if(!hasAnalyticsConsent())return;try{fetch('/api/analytics/page-view',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pageTitle:document.title,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,referrer:document.referrer||undefined})}).catch(()=>{})}catch(e){}}function trackEvent(eventName,eventCategory,eventValue,metadata){if(!hasAnalyticsConsent())return;try{if(typeof fetch==='undefined')return;const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),5000);fetch('/api/analytics/events',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({eventName,eventCategory,eventValue,metadata}),signal:controller.signal}).then(()=>clearTimeout(timeoutId)).catch(()=>clearTimeout(timeoutId))}catch(e){}}function setupEventTracking(){document.addEventListener('submit',function(e){if(e.target.matches('form[data-track="contact"]')||e.target.querySelector('input[type="email"]')){trackEvent('contact_form_submit','conversion',null,{form:e.target.action||window.location.pathname})}});document.addEventListener('click',function(e){if(e.target.closest('[data-speaker-id]')){trackEvent('speaker_view','engagement',null,{speakerId:e.target.closest('[data-speaker-id]').dataset.speakerId,page:window.location.pathname})}});document.addEventListener('click',function(e){const link=e.target.closest('a[href]');if(link&&link.hostname!==window.location.hostname){trackEvent('external_link_click','engagement',null,{url:link.href,text:link.textContent?.trim()||'unknown'})}});document.addEventListener('play',function(e){if(e.target.tagName==='VIDEO'){trackEvent('video_play','engagement',null,{src:e.target.src||e.target.currentSrc,duration:e.target.duration||null})}},true);let maxScroll=0,scrollTracked=false,scrollTimer=null;function trackScrollDepth(){try{const scrollHeight=document.body.scrollHeight-window.innerHeight;if(scrollHeight<=0)return;const scrollPercent=Math.round((window.scrollY/scrollHeight)*100);maxScroll=Math.max(maxScroll,scrollPercent);if(!scrollTracked&&maxScroll>=75){scrollTracked=true;trackEvent('scroll_depth','engagement',maxScroll,{page:window.location.pathname})}}catch(e){}}window.addEventListener('scroll',function(){if(scrollTimer)clearTimeout(scrollTimer);scrollTimer=setTimeout(trackScrollDepth,150)},{passive:true})}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){trackPageView();setupEventTracking()})}else{trackPageView();setupEventTracking()}let lastPath=window.location.pathname;setInterval(function(){if(window.location.pathname!==lastPath){lastPath=window.location.pathname;trackPageView()}},1000);window.trackEvent=trackEvent})();
